\section{Acquirement Setup}
    Previous to the implementation of algorithms video data to work on has to be organized. As already mentioned in the Fundamentals chapter \ref{sec:Fundamentals}, noisy images are hard to find and often do not suit the needs as base-data for the algorithm implementation. \\
    Therefore the described setup is created according to the specifications, also given in the Fundamentals chapter \ref{sec:Fundamentals}.\\

    The table \ref{table:usedHW_II} in combination with pictures \ref{fig:MK_I_schematic} and \ref{fig:MK_I_real} show the used Items and their constellation.
    \newline 
    
    \begin{table}[H]
        \centering
        \begin{tabular}{c|l|l}	
            \textbf{REF} & \textbf{Device} & \textbf{Description} \\ 
            \hline
            \textbf {1} & Laparoscope & capturing element\\
            \textbf {2} & Neoprene & penetrable skin \\
            \textbf {3} & Optic & inserted into trainer\\
            \textbf {4} & Cauter & active tool\\
        \end{tabular}
        \label{table:usedHW_II}
        \caption{Used hardware in first prototype \\ numbers correspond to \ref{fig:MK_II_schematic} and \ref{fig:MK_II_real}}
    \end{table}

    \paragraph{Cauter\\}
        Previous tests have shown that there is a urgent need to perform the data acquirement using real endoscopes and cauterization equipment.\\
        Since the cauterization method has great impact on the constellation and aspect of the emerging surgical smoke.
        The used cauter is a \textit{Aesculap Caiman 5 one-time-use Cauter \cite{sealer}} connected to a \textit{Aesculap HF-Generator \cite{hfgen}}.\\
        Both are professional equipment and commonly used in electo-surgeries.


    \paragraph{Phantom\\}
        The phantom is used to create a setup with realistic circumstances. The biggest advantage are realistic light conditions and proper access to the organs with respect to the planned movement patterns.\\
        Furthermore the Phantom prevents smoke and haze to leave the artificial Pseudopneumoperitoneum which is an obligatory aspect of realism in this scenario.\\

    \paragraph{Endoscopes\\}
        Most critical part of the generation is the actual frame grabbing of the endoscopes. The used endoscopes are on loan of the \gls{DKFZ}.\\
        The \textit{Stereo endoscope \cite{endocam}} collects 2 parallel videos which are grabbed by two identical frame grabbers \cite{epiphan} and then saved to RAM before they are written to the Computers hard drive. \\
        Writing to the RAM is done to prevent frame loss due to possible speed limitations of the hard disk. 
        This limits the time of the recordings to a maximum of less then one minute, but ensures the quality of the footage. \\
        

    \newpage


%%%%%%%%%%%%%%%%%%%%%%%%%% Pictures of Acquirement Setup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \begin{figure*}[hp]
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[scale=0.4]{pics/setups/setup2_schematic.png}
            \caption{\textbf{Schematic} \\
                Schematic of the data acquirement setup \\
                (1)Endoscope, (2)Neoprene, (3)Optic, (4)Electrocauter
            }
            \label{fig:MK_II_schematic}
        \end{subfigure}
        \hspace{1cm}
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[scale=0.4]{pics/setups/setup2_real.png}
            \caption{\textbf{Real} \\ 
                acquisition progress with Stereo-Laparoscope \\
                (1)Endoscope, (2)Neoprene, (3)Optic, (4)Electrocauter
            }
            \label{fig:MK_II_real}
        \end{subfigure}
        \caption{surgery phantom Setup}
        \label{fig:MK_II}
    \end{figure*}

    \newpage
        
    \newpage

    \subsection{Produced Data}
    The produced data can be put into 3 different categories. \\
    \paragraph{Static shots \\}
        The static shots are performed within a not moving environment.\\
        They show a scene in which the mentioned noises of surgeries slowly rise. This Video data can be used to test the Algorithm until a breaking point.
        E.g. steam rises slow within the environment and then starts to stick to the camera. The breaking point is then reached when the algorithm has no chance left to reconstruct the original image through the steam. \\

    \paragraph{Dynamic shots \\}
        The dynamic setups show scenes that include the most common movements in surgeries, \\ with are:
        \begin{itemize}
            \item rotations around the tool axis (-45 to 45 Degrees),
            \item insertions (push / pull) movements,
            \item rotations around the patients axis (-60 to 60 Degrees).
        \end{itemize}

    \paragraph{Realistic shots \\}
        Realistic shots do not follow a special form of movement pattern, but focus on a clear sight on the cauter and the parts that are incinerated. \\
        They combine all \textit{Dynamic Movements} mentioned above. But are in contrast to the Dynamic shots these movements are not intended. They result from the goal to keep the Endoscope focus on the operation area, the tools and the Organs that the surgeon works with. \\
        \newline
        This setup results in data that is very close to real surgery-footage, compared to the real data \cmt{Ref Günzburg} given by Dr.Widmaier.\\

    \begin{figure*}[hp]
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIRST ROW
        \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für plazierung neben einander
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/dynamicSmoke_s0.jpg}
            \caption{\textbf{dynamic Smoke}  \\
                Dynamic smoke 1
            }
            \label{fig:dynamic_1}
        \end{subfigure}
        ~ 
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/rotation_s0.jpg}
            \caption{\textbf{more dynamicsmoke} \\ 
            }
            \label{fig:dynamic_2}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/stain_s0.jpg}
            \caption{\textbf{even more dynamic smoke} \\ 
                Dynamic smoke 3
            }
            \label{fig:dynamic_3}
        \end{subfigure}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% second ROW
        \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/dynamicSmoke_s1.jpg}
            \caption{\textbf{dynamic Smoke}  \\
                Pic 1
            }
            \label{fig:dynamic_1}
        \end{subfigure}
        ~       % when I am Right, this should mean that they are placed next to each other
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/rotation_s1.jpg}
            \caption{\textbf{more dynamicsmoke} \\ 
                Picture 2
            }
            \label{fig:dynamic_2}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/stain_s1.jpg}
            \caption{\textbf{even more dynamic smoke} \\ 
                Dynamic smoke 2
            }
            \label{fig:dynamic_3}
        \end{subfigure}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% third ROW
        \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/dynamicSmoke_s2.jpg}
            \caption{\textbf{dynamic Smoke}  \\
                Pic 1
            }
            \label{fig:dynamic_1}
        \end{subfigure}
        ~       % when I am Right, this should mean that they are placed next to each other
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/rotation_s2.jpg}
            \caption{\textbf{more dynamicsmoke} \\ 
                Picture 2
            }
            \label{fig:dynamic_2}
        \end{subfigure}
        ~           
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/stain_s2.jpg}
            \caption{\textbf{even more dynamic smoke} \\ 
                Pictu 3
            }
            \label{fig:dynamic_3}
        \end{subfigure}
        ~
        \caption{Results of the Data Acquirement}
        \label{fig:DataAcq}
    \end{figure*}
    % This somehow does not display as expected....
    % maybe add even more pictures to fill the page.... I mean: there are more then enough...

    \newpage

\section{Real Data}
        \cmt{Last but not least} \\
        \cmt{Creds to Uwe Widmair} \\
        \newline
        \cmt{Pictures out of his different setups}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% MATH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Algorithmic \& Mathematical}

	\subsection{Fundamentals}
		\cmt{explanations about.... Color representation? - RGB BGR LAB}
        \fuck{Bring this into own Main Chapters!}

	\subsection{Detection}
		\subsubsection{Riot Detection in CCTV}
        \subsubsection{\cmt{another one would be nice}}
	\subsection{Filters}
		\subsubsection{Dark Channel Prior}
		\subsubsection{Model Based Removal}
		\subsubsection{Chromaticity Based Removal}
        \subsubsection{Depth Estimates}
		
	\subsection{Combination}
		\cmt{first find - then filter}
	
	\subsection{Implementation}
		The selected framework for the video manipulation is openCV \cmt{REF}. Used via the Pyhton3.6.7 on a Linux 18.04 with a 4.15.0-43 generic Kernel.\\
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% CODE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Code}
	\subsection{Mathematical functions - Implementation}

    	\begin{lstlisting}[language=Python]
def testingMode(self, frame):
    #create contrast
    mask = []
    mask.append(cv2.cvtColor(frame, cv2.COLOR_BGR2LAB))
    l, a, b = cv2.split(mask[0])

    #clahe means "Contrast Limited Adaptive Histogram Equalization"
    clahe = cv2.createCLAHE(clipLimit=3.0, tileGridSize=(4, 4))
    cl = clahe.apply(l)		# reduce contrast

    limg = cv2.merge((cl, a, b))
    mask.append(limg)

    res = cv2.cvtColor(limg, cv2.COLOR_LAB2BGR)

    return res, mask

		\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%        THIS is the FIRST LAB setup and will not be in the Thesis....
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%	\subsection{Test Setup}
%        Within the project multiple setups have been created. With each iteration of prototypes the quality of realism and the coverage of the requirements improved.\\
%        \newline
%        Since laparoscopes, cauters and other medical equipment tend to be rare and expensive within causal working environments the first prototype \ref{sec:Prototyp} focuses on a way to avoid this kind of professional equipment. With minor success in this belonging, a more realistic setup is created this Acquirement setup \ref{sec:Acquirement} uses real medical devices with have been provided by Prof. Dr. Alfred Franz and the \textit{DKFZ \gls{DKFZ}}. \\
%
%%%%%%%%%%%%%%%%%%%%%%%%%%% FAKE DATA %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        \subsubsection{Prototype} \label{sec:Prototype}
%            The first prototype was created to identify to most likely issues that could interfere with the data generation. \\
%            Prototype \texttt{\textbf{MK\_I}} is assembled from common items, out of pure convenience. Since the organization of real, fresh porcine visceral organs as well as the acquisition of corresponding medical equipment created various organizational and bureaucratic hurdles. \\
%            \newline
%            The table \ref{table:usedHW_I} in combination with pictures \ref{fig:MK_I_schematic} and \ref{fig:MK_I_real} show the used Items and their constellation.
%            \newline 
%            
%            \begin{table}[H]
%                \centering
%                \begin{tabular}{c|l|l}	
%                    \textbf{REF} & \textbf{Device} & \textbf{Description} \\ 
%                    \hline
%                    \textbf {1} & Raspberry PI & controlling element\\
%                    \textbf {2} & DSLR & Main Camera\\
%                    \textbf {3} & Webcam & USB-Camera\\
%                    \textbf {4} & Endoscope & close up shots\\
%                    \textbf {5} & Environmental sensor & Temperature/humidity\\
%                    \textbf {6} & Soldering Iron & improvised cauter\\
%                    \textbf {7} & LED light & controlled light source\\
%                \end{tabular}
%                \label{table:usedHW_I}
%                \caption{Used hardware in first prototype \\ numbers correspond to \ref{fig:MK_I_schematic} and \ref{fig:MK_I_real}}
%            \end{table}
%
%            The phantom is shown in the picture \ref{fig:MK_I_real}. These pictures where taken during the process of video generation. 
%            The schematic \ref{fig:MK_I_schmatic} shows the composition of the single components, with their connections to the internals. \\
%            An example of the created data is shown in picture \ref{fig:MK_I_result} \\
%            \newpage
%
%%%%%%%%%%%%%%%%%%%%%%%%%%% Pictures of Test Setup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		    \begin{figure*}[hp]
%                \begin{subfigure}[b]{\textwidth}
%                    \centering
%                    \includegraphics[scale=0.34]{pics/setups/setup1_schematic.png}
%                    \caption{\textbf{Schematic} \\
%                        Plan for fist Prototype, with the intention to evaluate Cameras and Tools. \\ 
%                        (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperature/Humidity Sensor, (7)LED-light source. \\
%                        \textit{Devices correspond to table \ref{tab:usedHW_I}.}
%                    }
%                    \label{fig:MK_I_schematic}
%                \end{subfigure}
%
%                \hspace{1cm}
%
%                \begin{subfigure}[b]{\textwidth}
%                    \centering
%                    \includegraphics[scale=0.4]{pics/setups/setup1_real.png}
%                    \caption{\textbf{Real} \\ 
%                        Real setup based on Schematic\ref{fig:MK_I_schematic}. \\
%                        (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperature/Humidity Sensor, (7)LED-light source. \\
%                        \textit{Devices correspond to table \ref{tab:usedHW_I}.}
%                    }
%                    \label{fig:MK_I_real}
%                \end{subfigure}
%
%                \hspace{1cm}
%
%                \begin{subfigure}[b]{\textwidth}
%                    \centering
%                    \includegraphics[scale=0.2]{pics/setups/setup1_result.png}
%                    \caption{\textbf{Result} \\ 
%                        Images taken form the videos produced with Setup \ref{fig:MK_I_real}. \\
%                        (1)DSLR-output, (2)Webcam-output, (3)Endocam-output.
%                    }
%                    \label{fig:MK_I_result}
%                \end{subfigure}
%
%                \caption{fist Surgery phantom Prototype}
%                \label{fig:MK_I}
%            \end{figure*}
%
%            \newpage
%
%            \paragraph{lessons learned}
%                Working with the first Prototype, resulted mostly in technical experience in the field of bench tests. \\
%                The evaluation of cameras and cauters had the conclusion that a generation of realistic data will only be possible with professional tools. \\
%                While the test of the laparoscopes phantom was quite successful, it created the need for further improvements, like a way to insert tools through a skin-like material. In all other means the phantom was suitable designed and fulfilled its purpose quite convenient. \\
%                \newline
%                The Prototype-setup therefore concluded that the given cameras are not sufficient to meet the requirements of the required data because:
%                \begin{itemize}
%                        \item their usage does not allow to perform the requested movements. 
%                        \item the produced smoke was created using a soldering Iron. \\
%                            Its Temperature curve is different to medical Thermokauters, which heat up way faster. \\
%                            Besides this most cauterization is performed using electrocauters. This type of cauters will create different forms and composition of  smoke than a thermal cauter.
%                \end{itemize}
%
%            First tests using the shown setup led to the assumption that the used cameras are not capable of creating realistic videos. \\
%            The smokes physical aspect is depended to the form of its creation. Smoke created by lasers will look different than Smoke created by a incineration using electro-cauters or thermal-cauters.
%
%            \newpage    % Check if that makes it nice
%
%%%%%%%%%%%%%%%%%%%%%%%%%% REAL DATA %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
