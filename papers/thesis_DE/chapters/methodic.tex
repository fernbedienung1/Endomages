\section{Generierung von Basisdaten}
\subsection{Laparoskopische Laborversuche}
    Während der Bearbeitung des Themas wurde es notwendig eigene Daten zu generieren, denn insbesondere verrauchte und verschmutzte Bilder werden von Chirurgen entsorgt, da dieser ja die für Mediziner notwendigen Areale verdecken.
    Zusätzlich dazu spielen Rechtliche Aspekte eine Rolle, den Patientendaten dürfen nur mit ausdrücklicher Einverständnis des betreffenden Patienten veröffentlicht werden. \\
    Um die Benötigten Daten selbst zu generieren wurden 2 Versuchs reihen erstellt.\\
    Prototyp 1 sollte mit relativ wenig Aufwand bereits brauchbare Ergebnisse und video aufnahmen von Rauch und Dampf erzeugen. Nach einem Fehlschlag dieses Vorhabens wurde unter deutlichem Mehraufwand ein zweiter Laborversuch initiiert welche brauchbare Ergebnisse lieferte.

    \subsubsection{Erster Prototyp}
        Der erste Prototyp besteht aus leicht zugänglichen Materialien und sollte das Problem der fehlenden endoskopischen Bilder mit wenig Aufwand lösen.\\
        Zum Einsatz kahmen die in Tabelle\ref{tab:usedHW_I} verwendenden Geräte.\\
        Hauptaugenmerk des ersten Prototypes war eine ''Machbarkeits Überprüfung'', bei der das Ziel war herauszufinden ob mittels der verwendeten Kameras Bilder erzeugt werden können die Laparoskopien ähnlich sind und sich als Basis für die Algorithmenentwicklung eignen. 
        \newline 

        \begin{table}[H]
            \centering
            \begin{tabular}{c|l|l}	
                \textbf{REF} & \textbf{Gerät} & \textbf{Beschreibung} \\ 
                \hline
                \textbf {1} & Raspberry PI & Steuergerät\\
                \textbf {2} & DSLR & Haupt-Kamera\\
                \textbf {3} & Webcam & USB-Kamera\\
                \textbf {4} & Endoscope & Amateur Endoskope\\
                \textbf {5} & Umgebungssensor & Temperatur/Feuchtigkeit\\
                \textbf {6} & Lötkolben & improvisierter Kauter\\
                \textbf {7} & LED licht & Lichtquelle innerhalb des Trainers\\
            \end{tabular}
            \label{tab:usedHW_I}
            \caption{Komponenten des ersten Prototypen, Nummern referenzieren \ref{fig:MK_I_schematic} und \ref{fig:MK_I_real}}
        \end{table}

%%%%%%%%%%%%%%%%%%%%%%% Pictures of Test Setup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        \newpage
	    \begin{figure*}[hp]
             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.34]{pics/setups/setup1_schematic.png}
                 \caption{\textbf{Schematic} \\
                     Plan for fist Prototype, with the intention to evaluate Cameras and Tools. \\ 
                     (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperature/Humidity Sensor, (7)LED-light source. \\
                     \textit{Devices correspond to table \ref{tab:usedHW_I}.}
                 }
                 \label{fig:MK_I_schematic}
             \end{subfigure}

             \hspace{1cm}

             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.4]{pics/setups/setup1_real.png}
                 \caption{\textbf{Real} \\ 
                     Real setup based on Schematic\ref{fig:MK_I_schematic}. \\
                     (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperature/Humidity Sensor, (7)LED-light source. \\
                     \textit{Devices correspond to table \ref{tab:usedHW_I}.}
                 }
                 \label{fig:MK_I_real}
             \end{subfigure}

             \hspace{1cm}

             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.2]{pics/setups/setup1_result.png}
                 \caption{\textbf{Result} \\ 
                     Images taken form the videos produced with Setup \ref{fig:MK_I_real}. \\
                     (1)DSLR-output, (2)Webcam-output, (3)Endocam-output.
                 }
                 \label{fig:MK_I_result}
             \end{subfigure}

             \caption{fist Surgery phantom Prototype}
             \label{fig:MK_I}
         \end{figure*}

         \newpage

         Das Erkenntnisse des ersten Prototypen folgerten das eine sinnvolle Aufnahme von Daten nur mit medizinischen Endoskopen zu Stande kommen kann.\\
         
    \newpage   
    \subsubsection{Zweiter Prototyp}

        Zweiter Prototyp des Laparoskopie Trainers, mit Verbesserung des Zugangs via Neoprenhaut \ref{fig:phantomI}.\\
        \begin{table}[H]
            \centering
            \label{tab:Kameras}
            \begin{tabular}{l|l|l|l}	%all left aligned
                \textbf{Company} & \textbf{Model} & \textbf{Type} & \textbf{REF}\\ 
                \hline
                Wolf & Endocam & Bronchoscope & \cite{endocam} \\		%1CCD Endocam 5520 
                Wolf & 3D-Endocam & Stereoendscope & \cite{} \\		%3D-HD-Endocam F1014 
                IDS & ui-3240cp & 1280x1024/60FPS& \cite{} \\ 
                Nikon & D3400 & 6000x4000 & \cite{dslr} \\
                Logitec & C270 & 1280x720 & \cite{webcam} \\
                Alcor Micro & SJ00446 & 1280x170 & \fuck{NONE} \\
                \hline
                Aesculap & Caiman 5 & Vessel sealer & \cite{sealer} \\
                Aesculap & Letrafuse & RF-Generator & \cite{hfgen} \\
            \end{tabular}
            \caption{Capturing and cauterisation Hardware}
        \end{table}

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{pics/setups/Laparoscope_box.jpg}
            \caption{Gesamt Aufnahme des gebauten Laparoskopie Trainers}
            \label{fig:phantomI}
        \end{figure}
        
        Einstiche im Neoprenstoff für die Einbringung der Werkzeuge in das künstliche Peritoneum \ref{fig:phantomII}.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{pics/setups/Laparoscope_box_cover.jpg}
            \caption{Neoprensstoff im Deckel des Trainers, mit Einstichen der Werkzeuge und des Endoskopes}
            \label{fig:phantomII}
        \end{figure}

        \cmt{ hier noch bissle text über den Trainer bzw Organ Transport etc. }

        \begin{table}[H]
            \centering
            \begin{tabular}{c|l|l}	
                \textbf{REF} & \textbf{Gerät} & \textbf{Beschreibung} \\ 
                \hline
                \textbf {1} & Endoskope & Aufnahmeelement\\
                \textbf {2} & Neopren & Haut für Einstiche\\
                \textbf {3} & Optik & einzuführender teil des Endoskopes\\
                \textbf {4} & Kauter & Verbrennung Werkzeug\\
            \end{tabular}
            \label{tab:usedHW_II}
            \caption{benutzte Geräte und Werkzeuge\\ Nummern referenzieren \ref{fig:MK_II_schematic} und \ref{fig:MK_II_real}}
        \end{table}

        \cmt{Bilder aus Fundamentals }
        \begin{figure*}[hp]
            \begin{subfigure}[b]{\textwidth}
                \centering
                \includegraphics[scale=0.4]{pics/setups/setup2_schematic.png}
                \caption{Schematische Darstellung des Versuchsaufbaus\\
                    (1)Endoskope, (2)Neopren, (3)Optik, (4)Elektrokauter
                }
                \label{fig:MK_II_schematic}
            \end{subfigure}
            \hspace{1cm}
            \begin{subfigure}[b]{\textwidth}
                \centering
                \includegraphics[scale=0.4]{pics/setups/setup2_real.png}
                \caption{Bild aus der Generierung der Testdaten mit einem Stereoendoskope,\\
                    (1)Endoskope, (2)Neopren, (3)Optik, (4)Elektrokauter
                }
                \label{fig:MK_II_real}
            \end{subfigure}
            \caption{Aufbau der Daten Generierung}
            \label{fig:MK_II}
        \end{figure*}

\iffalse
        \cmt{ Und hier ist das Ergebnis  }


        \begin{figure*}[hp]
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIRST ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für plazierung neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s0.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Dynamic smoke 1
                }
                \label{fig:dynamic_1}
            \end{subfigure}
            ~ 
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s0.jpg}
                \caption{\textbf{more dynamicsmoke} \\ 
                }
                \label{fig:dynamic_2}
            \end{subfigure}
            ~
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_stain_s0.jpg}
                \caption{\textbf{even more dynamic smoke} \\ 
                    Dynamic smoke 3
                }
                \label{fig:dynamic_3}
            \end{subfigure}
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% second ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s1.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Pic 1
                }
                \label{fig:dynamic_1}
            \end{subfigure}
            ~       % when I am Right, this should mean that they are placed next to each other
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s1.jpg}
                \caption{\textbf{more dynamicsmoke} \\ 
                    Picture 2
                }
                \label{fig:dynamic_2}
            \end{subfigure}
            ~
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_stain_s1.jpg}
                \caption{\textbf{even more dynamic smoke} \\ 
                    Dynamic smoke 2
                }
                \label{fig:dynamic_3}
            \end{subfigure}
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% third ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s2.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Pic 1
                }
                \label{fig:dynamic_1}
        \end{subfigure}
        ~       % when I am Right, this should mean that they are placed next to each other
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s2.jpg}
            \caption{\textbf{more dynamicsmoke} \\ 
                Picture 2
            }
            \label{fig:dynamic_2}
        \end{subfigure}
        ~           
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/old_stain_s2.jpg}
            \caption{\textbf{even more dynamic smoke} \\ 
                Pictu 3
            }
            \label{fig:dynamic_3}
        \end{subfigure}

        \caption{Results of the Data Acquirement}
        \label{fig:DataAcq}
    \end{figure*}
    % This somehow does not display as expected....
    % maybe add even more pictures to fill the page.... I mean: there are more then enough...

    \newpage
\fi
\subsubsection{Reale Daten}
    Durch einen Kontakt bei der Firma NewTec GmbH wurde es möglich Reale intraoperative Bilder von Laparoskopien zu erhalten.
    Diese Bilder hatten maßgeblichen Einfluss auf die Entstehung der Aufnahmen des zweiten Prototypes und Dienten als Referenz in Bezug auf Realismus.\\
    \newline
    Die Bilder selbst unterliegen jedoch dem Datenschutz der Patienten und dürfen deshalb nicht in der Arbeit auftauchen.


\section{Daten Bearbeitung}
Die generierten Daten dienen im Folgenden als Basis für die Bildanpassungsalgorithmen.\\
Da das Ergebnis der Basisdatengenerierung aus Videodateien in .avi-formaten besteht ist es vorerst nötig diese zu konvertieren, anzupassen und Bilder zu generieren.\\
Um die Größe der Videos auf eine einfach zu verwendbare Größe zu konvertieren wurden die .avi Dateien mittels FFMPEG zu .mp3 Dateien mit einer Auflösung von 800x600px Konvertiert.\\

\begin{lstlisting}[language=bash, numbers=none]
    for i in ./VideoFiles; do 
        ffmpeg -vf scale=800x600 -i $i $i.mp3
    done
\end{lstlisting}

    Für die Verwendung der erstellten Bildbearbeitungsprogamme werden Bilder im JPG-format verwendet, wobei das Format sowie die Auflösung der Bilder aus Einfachheit so gewählt wurde damit möglichst viele Sprachen und Bibliotheken eine Bearbeitung zulassen.\\
    
    \subsection{Histogram Equalization}
        Für die Implementierung des im Grundlagen-Kapitel \ref{sec:Fundamentals} beschriebenen Histogram Matchings ist es nötig Histogramme der Eingabe Bilder zu erstellen.
        
\section{Evaluation}
    \subsection{Eigene vs. Reale Daten}
        \begin{itemize}
                \item histogramme als Vergelichsbasis Real vs Own.
                \item Expertenmeinung
                \item
        \end{itemize}
    \subsection{Bildbearbeitung}

