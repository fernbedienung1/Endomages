\section{Generierung von Basisdaten}
Die hier beschriebenen Daten sind unter der DOI \textbf{10.6084/m9.figshare.7969367} \cite{myfuckigself} als Download unter GNU GPL 3.0 verfügbar \href{https://figshare.com/articles/2018-12-21-EndoscopicSmoke/7969367}{figshare}.\\
Die Dortige Datei \textbf{''SurgicalNoises.zip''} enthält die auf 800x600 Pixel verkleinerten Videos im mp4 Format, dadurch beschränkt sich die Größe der Datei auf 1.1GB.\\
\newline
Sourcen der erstellten skripte sind ebenfalls unter GNU GPL 3.0 verfügbar auf \href{https://github.com/fernbedienung1/Endomages.git}{GitHub}.\\


\subsection{Laparoskopische Laborversuche}
    Während der Bearbeitung des Themas wurde es notwendig eigene Daten zu generieren, denn insbesondere verrauchte und verschmutzte Bilder werden von Chirurgen entsorgt, da dieser ja die für Mediziner notwendigen Areale verdecken.
    Zusätzlich dazu spielen Rechtliche Aspekte eine Rolle, den Patientendaten dürfen nur mit ausdrücklicher Einverständnis des betreffenden Patienten veröffentlicht werden. \\
    Um die Benötigten Daten selbst zu generieren wurden 2 Versuchs reihen erstellt.\\
    Prototyp 1 sollte mit relativ wenig Aufwand bereits brauchbare Ergebnisse und video aufnahmen von Rauch und Dampf erzeugen. Nach einem Fehlschlag dieses Vorhabens wurde unter deutlichem Mehraufwand ein zweiter Laborversuch initiiert welche brauchbare Ergebnisse lieferte.

    \subsubsection{Erster Prototyp}
        Der erste Prototyp besteht aus leicht zugänglichen Materialien und sollte das Problem der fehlenden endoskopischen Bilder mit wenig Aufwand lösen.\\
        Zum Einsatz kahmen die in Tabelle\ref{tab:usedHW_I} verwendenden Geräte.\\
        Hauptaugenmerk des ersten Prototypes war eine ''Machbarkeits Überprüfung'', bei der das Ziel war herauszufinden ob mittels der verwendeten Kameras Bilder erzeugt werden können die Laparoskopien ähnlich sind und sich als Basis für die Algorithmenentwicklung eignen. 
        \newline 
        
        \begin{table}[H]
            \centering
            \begin{tabular}{l|l|l|l}	%all left aligned
                \textbf{Hersteller} & \textbf{Model} & \textbf{Type} & \textbf{REF}\\ 
                \hline
                Nikon & D3400 & 6000x4000 & \cite{dslr} \\
                Logitec & C270 & 1280x720 & \cite{webcam} \\
                Alcor Micro & SJ00446 & 1280x170 & NONE \\
                \hline
                Weller & Lötkolben & std & \cite{iron} \\
                \hline 
                Selfmade & V01 & Umbebungssensor & \cite{RJ} \\
            \end{tabular}
            \caption{Aufnahme Geräte, Kauter und Sensoren\label{tab:recHW_1}}
        \end{table}
    
        Tabelle \ref{tab:recHW_1} listet die die Verwendeten Komponenten für die Vorabversuche.
        Die Geräte sind insbesondere für Laien erschwingliche und verfügbare Geräte. Ziel des Versuchs ist es einen gesamt Eindruck über die Komplexität der Versuche zu erhalten um die Komplexität sowie den Aufwand für Folgeversuche abzuschätzen.

        \begin{table}[H]
            \centering
            \begin{tabular}{c|l|l}	
                \textbf{REF} & \textbf{Gerät} & \textbf{Beschreibung} \\ 
                \hline
                \textbf {1} & Raspberry PI & Steuergerät\\
                \textbf {2} & DSLR & Haupt-Kamera\\
                \textbf {3} & Webcam & USB-Kamera\\
                \textbf {4} & Endoscope & Amateur Endoskope\\
                \textbf {5} & Umgebungssensor & Temperatur/Feuchtigkeit\\
                \textbf {6} & Lötkolben & improvisierter Kauter\\
                \textbf {7} & LED licht & Lichtquelle innerhalb des Trainers\\
            \end{tabular}
            \caption{Komponenten des ersten Prototypen, Nummern referenzieren \ref{fig:MK_I_schematic} und \ref{fig:MK_I_real}\label{tab:usedHW_I}}
        \end{table}
        
%%%%%%%%%%%%%%%%%%%%%%% Pictures of Test Setup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	    \begin{figure*}[hp]
             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.34]{pics/setups/setup1_schematic.png}
                 \caption{\textbf{Schematischer Aufbau} \\
                     (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperatur- und  Luftfeuchtigkeits-Sensor, (7)LED-Licht \\
                     \textit{Geräte wie in Tabelle \ref{tab:usedHW_I}.} \\
                 }
                 \label{fig:MK_I_schematic}
             \end{subfigure}

             \hspace{2cm}

             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.4]{pics/setups/setup1_real.png}
                 \caption{\textbf{Realer Aufbau} \\ 
                     (1)Raspberry PI B3+, (2)DSLR, (3)Webcam, (4)Endocam, (5)Temperatur- und  Luftfeuchtigkeits-Sensor, (7)LED-Licht \\
                     \textit{Geräte wie in Tabelle \ref{tab:usedHW_I}.}
                 }
                 \label{fig:MK_I_real}
             \end{subfigure}

             \hspace{2cm}

             \begin{subfigure}[b]{\textwidth}
                 \centering
                 \includegraphics[scale=0.2]{pics/setups/setup1_result.png}
                 \caption{\textbf{Ergebnis Bilder} \\ 
                     Bilder aus den Videos des Aufbaus\ref{fig:MK_I_real}. \\
                     (1)DSLR-output, (2)Webcam-output, (3)Endocam-output.
                 }
                 \label{fig:MK_I_result}
             \end{subfigure}

             \caption{Prototype für Laborversuche}
             \label{fig:MK_I}
         \end{figure*}
        \newpage

    \subsubsection{Zweiter Prototyp}

        Aus den Ergebnissen des Ersten Prototypes ging hervor das es ohne echte Endoskope und Kauter nur schwer möglich ist Daten zu erzeugen die realen Operationen ähneln. Als Resultat dessen sind die eingesetzten Kameras, Werkzeuge und auch der Trainer in dem die Versuche durchgeführt werden verbessert worden.. \\
        Um darüber hinaus bessere Ergebnisse zu erzielen werden zusätzlich qualitativ hochwertigere Organe verwendet, sowie vom Versuchstier Rind auf Schwein gewechselt.\\
        \begin{table}[H]
            \centering
            \begin{tabular}{l|l|l|l}	%all left aligned
                \textbf{Hersteller} & \textbf{Model} & \textbf{Type} & \textbf{REF}\\ 
                \hline
                Wolf & Endocam & Bronchoscope & \cite{endocam} \\
                Wolf & 3D-Endocam & Stereoendscope & \cite{3DHD} \\	
                IDS & ui-3240cp & 1280x1024/60FPS& \cite{ids} \\ 
                \hline 
                OSRAM & Xenophot & 150W Halogen & NONE \\
                \hline
                Aesculap & Caiman 5 & Vessel sealer & \cite{sealer} \\
                Aesculap & Letrafuse & RF-Generator & \cite{hfgen} \\
            \end{tabular}
            \caption{Aufnahmegeräte und Kauter\label{tab:recHW_2}}
        \end{table}

        Der Aufbau des 21.12.2018 beinhaltet die Hardware aus Tabelle \ref{tab:recHW_2}.\\
        Zweiter Prototyp des Laparoskopie Trainers, mit Verbesserung des Zugangs via Neoprenhaut \ref{fig:phantomI}.\\


        \begin{figure}[H]
            \centering
            \includegraphics[width=\textwidth]{pics/setups/Laparoscope_box.jpg}
            \caption{Gesamt Aufnahme des gebauten Laparoskopie Trainers}
            \label{fig:phantomI}
        \end{figure}
        
        Einstiche im Neoprenstoff für die Einbringung der Werkzeuge in das künstliche Peritoneum \ref{fig:phantomII}.

        \begin{figure}[H]
            \centering
            \includegraphics[width=\textwidth]{pics/setups/Laparoscope_box_cover.jpg}
            \caption{Neoprensstoff im Deckel des Trainers, mit Einstichen der Werkzeuge und des Endoskopes}
            \label{fig:phantomII}
        \end{figure}

        \begin{table}[H]
            \centering
            \begin{tabular}{c|l|l}	
                \textbf{REF} & \textbf{Gerät} & \textbf{Beschreibung} \\ 
                \hline
                \textbf {1} & Endoskope & Aufnahme Element\\
                \textbf {2} & Neopren & Haut für Einstiche\\
                \textbf {3} & Optik & einzuführender teil des Endoskopes\\
                \textbf {4} & Kauter & Verbrennung Werkzeug\\
            \end{tabular}
            
            \caption{benutzte Geräte und Werkzeuge\\ Nummern referenzieren \ref{fig:MK_II_schematic} und \ref{fig:MK_II_real}\label{tab:usedHW_II}}
        \end{table}


        Beim Zweiten Prototyp werden frische Organe verwendet die am Morgen des Versuchstages geschlachtet wurden. Die Frische der Organe ist wichtig da so die Feuchtigkeit des Gewebes erhalten bleibt. 
        \begin{figure}[H]
            \centering
            \includegraphics[width=\textwidth]{pics/setups/organs_marked.png}
            \caption{Organe vor der Videodaten Generierung}
            \label{fig:organs}
        \end{figure}

        \begin{table}[H]
            \centering
            
            \begin{tabular}{l|c|c}	%all left aligned
                \textbf{RefNr} & \textbf{Organ} & \textbf{Bemerkung} \\
                \hline
                \textbf {1} & Leber & Hämerperfusioniert\\
                \textbf {2} & Magen & inklusive Drüsen\\
                \textbf {3} & Milz & Hämerperfusioniert\\
                \textbf {4} & Lunge & beide Lungen\\
                \textbf {5} & Speise- \& Luftröhre & komplettes \\
                \textbf {6} & Zunge & gesamter Kehlkopf\\
                \textbf {7} & Fettnetz & Omentum Majus \\
            \end{tabular}
            \caption{verwendete Organe des 2ten Testaufbaus\label{tab:organlist}}
        \end{table}

        Da die Organe (Tabelle \ref{tab:organlist} und Bild \ref{fig:organs}) von mehreren Tieren stammen wird darauf geachtet das nur jeweils zusammenpassende bzw. zusammenhängende Organe gleichzeitig im Trainer verwendet werden.

        \begin{figure*}[hp]
            \begin{subfigure}[b]{\textwidth}
                \centering
                \includegraphics[scale=0.4]{pics/setups/setup2_schematic.png}
                \caption{Schematische Darstellung des Versuchsaufbaus\\
                    (1)Endoskope, (2)Neopren, (3)Optik, (4)Elektrokauter
                }
                \label{fig:MK_II_schematic}
            \end{subfigure}
            \hspace{1cm}
            \begin{subfigure}[b]{\textwidth}
                \centering
                \includegraphics[scale=0.4]{pics/setups/setup2_real.png}
                \caption{Bild aus der Generierung der Testdaten mit einem Stereoendoskope,\\
                    (1)Endoskope, (2)Neopren, (3)Optik, (4)Elektrokauter
                }
                \label{fig:MK_II_real}
            \end{subfigure}
            \caption{Aufbau der Daten Generierung}
            \label{fig:MK_II}
        \end{figure*}
        \clearpage

        \iffalse
        \begin{figure*}[hp]
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIRST ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für plazierung neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s0.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Dynamic smoke 1
                }
                \label{fig:dynamic_1}
            \end{subfigure}
            ~ 
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s0.jpg}
                \caption{\textbf{more dynamicsmoke} \\ 
                }
                \label{fig:dynamic_2}
            \end{subfigure}
            ~
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_stain_s0.jpg}
                \caption{\textbf{even more dynamic smoke} \\ 
                    Dynamic smoke 3
                }
                \label{fig:dynamic_3}
            \end{subfigure}
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% second ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s1.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Pic 1
                }
                \label{fig:dynamic_1}
            \end{subfigure}
            ~       % when I am Right, this should mean that they are placed next to each other
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s1.jpg}
                \caption{\textbf{more dynamicsmoke} \\ 
                    Picture 2
                }
                \label{fig:dynamic_2}
            \end{subfigure}
            ~
            \begin{subfigure}[b]{0.3\textwidth}
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_stain_s1.jpg}
                \caption{\textbf{even more dynamic smoke} \\ 
                    Dynamic smoke 2
                }
                \label{fig:dynamic_3}
            \end{subfigure}
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% third ROW
            \begin{subfigure}[b]{0.3\textwidth}     % eindritteln der Textfläche für neben einander
                \centering
                \includegraphics[width=\textwidth]{pics/ownData/old_dynamicSmoke_s2.jpg}
                \caption{\textbf{dynamic Smoke}  \\
                    Pic 1
                }
                \label{fig:dynamic_1}
        \end{subfigure}
        ~       % when I am Right, this should mean that they are placed next to each other
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/old_rotation_s2.jpg}
            \caption{\textbf{more dynamicsmoke} \\ 
                Picture 2
            }
            \label{fig:dynamic_2}
        \end{subfigure}
        ~           
        \begin{subfigure}[b]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{pics/ownData/old_stain_s2.jpg}
            \caption{\textbf{even more dynamic smoke} \\ 
                Pictu 3
            }
            \label{fig:dynamic_3}
        \end{subfigure}

        \caption{Results of the Data Acquirement}
        \label{fig:DataAcq}
    \end{figure*}
    \fi

    \newpage
\subsubsection{Reale Daten}
    Durch einen Kontakt bei der Firma NewTec GmbH wurde es möglich Reale intraoperative Bilder von Laparoskopien zu erhalten.
    Diese Bilder hatten maßgeblichen Einfluss auf die Entstehung der Aufnahmen des zweiten Prototypes und Dienten als Referenz in Bezug auf Realismus.\\
    \newline
    Die Bilder selbst unterliegen jedoch dem Datenschutz der Patienten und dürfen deshalb nicht in der Arbeit auftauchen.\\
    \newline
    Der Ausschnitt \ref{fig:wolfVid} einem auf Youtube veröffentlichten Werbe-Video der Firma RICHARD WOLF GmbH von 2014 \cite{WolfVid} zeigt ein Bild das ebenfalls mit dem Stereoendoskop 3DHD \cite{3DHD} aufgenommen wurde und den Aufnahmen Uwe Widmaiers \cite{uwe} stark ähnelt.\\
    Das Bild zeigt einen Elektrokauter, der zum schneiden von Gewebe verwendet wird und Ansätze von Surgical smoke, welcher sich im Pneumoperitoneum ausbreitet.
    \begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{pics/usable_unsure/wolfVid.jpg}
        \caption{
            Aufnahme einer realen Laparoskopische Eingriffes \\
            Aufgenommen mit einem 3DHD \cite{3DHD}, \\
            Werkzeug im Bild ist ein Monopolarer Elektrokauter.\\
        }
        \label{fig:wolfVid}
    \end{figure}


\newpage
\section{Daten Bearbeitung}
Die generierten Daten dienen im Folgenden als Basis für die Bildanpassungsalgorithmen.\\
Da das Ergebnis der Basisdatengenerierung aus Videodateien in .avi-formaten besteht ist es vorerst nötig diese zu konvertieren, anzupassen und Bilder zu generieren.\\
Um die Größe der Videos auf eine einfach zu verwendbare Größe zu konvertieren wurden die .avi Dateien mittels FFMPEG zu .mp3 Dateien mit einer Auflösung von 800x600px Konvertiert.\\

    \subsection{Vorverarbeitung}
        Ziel der Vorverarbeitung ist es die aus den Versuchen generierten Video Rohdaten für die Implementation vorzubereiten.
        Beispielsweise werden für die ersten versuche der Bildbearbeitung mit den bereits erwähnten Gamma/Kontrast/Helligkeit -filtern einzelne Bilder (Frames) der Videos benötigt.\\
        Die Vorverarbeitung soll die Daten aufbereiten um komfortables arbeiten mit ihnen zu ermöglichen, indem die Videos in Standard Formate mit kleineren Größen konvertiert werden. Mit den Bildern wird gleich verfahren.\\
        \newline

        Durch die Verwendung einer Bash auf einem Linuxsystem kann mittels ffmpeg in wenigen Zeilen die Konversion aller Video-Dateien angestoßen werden \ref{code:vidConf}.

\begin{lstlisting}[language=bash, numbers=none, caption={converting avi to scaled mp4}, label={code:vidConf}]
    for i in ./VideoFiles; do 
        ffmpeg -vf scale=800x600 -i $i $i.mp4
    done
\end{lstlisting}

        Das Ergebnis der Umwandlung sind deutlich kleinere Videos, in einem Format das die Ziel-Sprachen Python3.7, Octave, C++ einfach und schnell verwenden können\ref{tab:formateVid}.
        \begin{table}[h]
            \centering
            \begin{tabular}{c|c|c|c}
                newonversion & Format & Dateigröße & Geometrie\\
                \hline
                input: & AVI & 837MB & 1920x1080\\
                output: & MP4 & 9,4MB & 800x600 \\
            \end{tabular}
            \caption{Informationen der Konversion\\
                File:\\
                Stereo-LiverTest-Smoke-RotLapAxis-\#1-Right.avi
                \label{tab:formatVid}
            }
        \end{table}

        der Coder \ref{code:vidConf} wandelt die Eingabe Videos in ein besser handhabbares Format um \ref{tab:formateVid}. \\
        Aus den MP4 Videos ist es nun leicht Bilder zu extrahieren, die Herangehensweise hierbei ist es jede Sekunde des Videos einen Screenshot zu erstellen.\\
        \newline
        Das Skript \textbf{shotGrabber.py} \ref{code:shotGrabber} dient als folge Skript um aus den generierten Videodaten letztendlich Bilder zu erstellen.\\
        \lstinputlisting[language=Python, caption={script zur sekündlichen Erstellung von Screenshots}, label={code:shotGrabber}, firstline=14, lastline=28]
        {../../work/scripts/shotGrabber.py} 

        Die Vorgehensweise dabei ist es alle Videos anzusehen und dann nach jeweils einer Sekunde einen Screenshot abzuspeichern. Der Screenshot ist hierbei der aktuelle Frame des Videos \ref{code:shotGrabber} Zeile 12.\\
        Gespeichert werden die Bilder jeweils in einen Ordner mit dem Namen des Videos, die Files selbst haben einen einheitlichen Namen: \textit{''shot\_\%d.jpg''}, wobei das \textit{\%d} die Sekunde der Aufnahme codiert. \\
        Das Ergbnis  der Bilddaten Generierung sind 1244 (221 Originale aus \cite{uwe} und 1023 Bilder aus den Selbst gerierten Daten). \\
        \newline
        Diese Bilder dienen im Anschluss als Eingabe für ebensoviele Histogramme.

    \subsection{Histogramme als Vergleichs Grundlage}
        Mit Hilfe des \ref{code:histPY_calc} Scriptes, können Histogramme erzeugt werden, die Auskunft über die farbliche Zusammensetzung der Bilder geben. 

        \lstinputlisting[language=Python, caption={Histogram Generator Skript, Methode:calcHist}, label={code:histPY_calc}, firstline=22, lastline=44]
        {../../work/scripts/hist.py}         

        Die Methode zeigt das iterative kumulieren der Werte jedes Pixels, die Arrays \lstinline{hhist_b, hist_g, hist_r} enthalten die Anzahl der \lstinline{uint8_t} werte für die Farbkanäle Rot, Grün und Blau des RGB Formates.\\
        Weitere Methoden sorgen dann für die generation von csv-dateien für die Weiterverarbeitung \ref{code:histPY_csv} oder für die Darstellung als Kurve \ref{code:histPY_fun}. \\
        \lstinputlisting[language=Python, caption={Histogram Generator Skript, Methode:createCSV}, label={code:histPY_csv}, firstline=80, lastline=90]
        {../../work/scripts/hist.py}
        \lstinputlisting[language=Python, caption={Histogram Generator Skript, Methode:histLong}, label={code:histPY_fun}, firstline=93, lastline=129]
        {../../work/scripts/hist.py}

        Der Ausgabe Plot für das Kommando:\lstinline{gram shot_24.jpg -l s24.csv -o hist_24.png} sieht wie folgt aus \ref{fig:histInUse}.\\
        
        \begin{figure*}[h]
                \includegraphics[width=\textwidth]{pics/code/histInUse.png}
                \label{fig:histInUse_code}
                \caption{Hilfe und Verwendung des Histogram-Erstellungs Scripts}
        \end{figure*}

        \begin{figure*}[h]
            \centering
            \begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{pics/code/shot_24.jpg}
                \caption{Eingabe Datei von \ref{fig:histInUse}}
                \label{fig:histInUse_in}
            \end{subfigure}
            ~
            \begin{subfigure}[b]{0.4\textwidth}
                \includegraphics[width=\textwidth]{pics/code/hist_24.png}
                \caption{Ausgabe Datei von \ref{fig:histInUse}}
                \label{fig:histInUse_out}
            \end{subfigure}
            \caption{Ein und Ausgabe sowie Screenshot des Prozesses des Histogramgenerators \ref{fig:histPYcode}}
            \label{fig:histInUse}
        \end{figure*}

        Der Parameter \lstinline{ --createCSV} sorgt dafür dass die Arrays \lstinline{hhist_b, hist_g, hist_r} als csv-datei abgespeichert werden. So können später alle Farbwerte aufsummiert werden um ein Gesamthistogram über beispielsweise ein Gesamtes Video zu generieren.\\
        Die Resultierenden CSV Dateien werden dann mittels des Scriptes \ref{code:collectorPY} zusammengefasst.\\ 
        Gruppiert wird nach Quelle: ein Histogram beschreibt die Zusammensetzung aller Realen Daten die durch Uwe Widmaier \cite{uwe} aufgezeichnet wurden und ein weiteres über die Daten die im Laborversuch selbst erstellt wurden.\\
        Auf der Grundlage dieser Histogramme können die erstellten Daten mit den Realen verglichen und evaluiert werden.\\
        Der explizite Code zu diesem vorgehen findet sich im \ref{sec:Appendix}, sowie eine Liste der generierten Daten. \\
        Die Ergebnisse der hier beschriebenen Algorithmen finden sich im Kapitel Ergebnis \ref{sec:Results}.\\

        \newpage
         \subsection{Anwendung von Bildanpassungsalgorithmen}
        
            Die unter \ref{sec:Fundamentals} beschriebenen Algorithmen wirken sehen im code folgendermassen aus \ref{code:plotIt}.
            Dieses Skript produziert die Ausgabe bilder in \ref{fig:imageAdjust}. \\
            \begin{figure}[H]
                \begin{subfigure}[h]{0.4\textwidth}
                    \includegraphics[width=\textwidth]{pics/eval/example_pic_0.jpg}
                    \label{fig:contrast}
                    \caption{
                        Originales eingabe Bild 
                    }
                \end{subfigure}
                ~
                \begin{subfigure}[h]{0.4\textwidth}
                    \includegraphics[width=\textwidth]{pics/eval/brightness.jpg}
                    \label{fig:contrast}
                    \caption{
                        Änderung der Helligkeit um 10\%
                    }
                \end{subfigure}
                ~
                \begin{subfigure}[h]{0.4\textwidth}
                    \includegraphics[width=\textwidth]{pics/eval/gamma.jpg}
                    \label{fig:contrast}
                    \caption{
                        Änderung des Gamma-wertes um 10\%
                    }
                \end{subfigure}
                ~
                \begin{subfigure}[h]{0.4\textwidth}
                    \includegraphics[width=\textwidth]{pics/eval/sigmoid.jpg}
                    \label{fig:contrast}
                    \caption{
                        Änderung des Kontrastes mittels Sigmoid-funktion um 10\%
                    }
                \end{subfigure}
                \label{fig:imageAdjust}
                \caption{Bildbearbeitung von intraoperativen Bildern}
            \end{figure}

            Die Anpassung wird hier bereits über Histogrammatching vorgenommen, welches die kumulierte Summe der Bilder an eine Eingabe Funktion anpasst.
            Dadurch ensteht eine Matrix die auf die Pixel des Bildes angewandt werden kann und so jeden Pixel anpasst.

        
        \subsection{Histogram Equalization}
            Für die Implementierung des im Grundlagen-Kapitel \ref{sec:Fundamentals} beschriebenen Histogram Matchings ist es nötig Histogramme der Eingabe Bilder zu erstellen. Die Implementierung dieser Mathematischen Funktionen erfolgt aus Performance-Gründen mittels Octave.\\
            So kann die Histogramm Generierung, die bisher mittels des python Skripts hist.py \ref{code:histPY_calc} erreicht wurde, verkürzt werden.\\
            \newline
            Der unterschied der den immensen Geschwindigkeitszuwachs ermöglicht ist hierbei nicht der Wechsel der Sprache, sondern der Methodik.\\
            Während das python-Script iterativ alle Pixel aufsummiert, ist die Vorgehensweise des Octave Scripts vektoriell. Dies kann mit Hilfe der numpy-Bibliothek auch in Python realisiert werden\cite{numpy}.
            Der Zeitgewinn durch die Vektorielle Rechnung mittels Octave ist immens, er verringert sich von ca 4 Minuten (für RGB Histogramme ungefähr 12 Minuten)) auf unter 1 Sekunde auf dem Verwendeten System. \\
            Den entsprechenden Code zeigt der Auszug \ref{code:histogram} aus histogram.m \ref{code:histogramM}.\\

\lstinputlisting[language=matlab, caption={octave implementierung der Histogramm Erstellung}, label={code:histogram}]
        {../../work/mathe/own/histogram.m}

        Diese Version des Codes erzeugt allerdings ein Histogram über die Graustufen des Bildes um ein eindimensionales Array zu erhalten, wärend \ref{code:histPY_calc} für jeweils Rot, Grün und Blau eigene Histogramme erstellt.
        Für die Anpassung mittels Histogram-Matching wird im code \ref{code:histogram} ein eindimensionaler Vektor erstellt ( Zeile 5 ). Durch die Bildung des Mittelwertes wird so ein Monochromes Bild erstellt. Monochrome Bilder bestehen nur aus Graustufen und deren Histogramme sind entsprechenden eindimensionale Matrizen, sprich lediglich Vektoren.\\
